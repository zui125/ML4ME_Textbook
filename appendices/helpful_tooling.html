<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Appendix A — Helpful Tooling for Working with and Debugging Machine Learning Models – Machine Learning for Mechanical Engineering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../appendices/course_progression.html" rel="next">
<link href="../notebooks/loss_functions_for_linear_models.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0dd2bd5de344125cf763a379ddc3eb04.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../appendices/helpful_tooling.html">Appendices</a></li><li class="breadcrumb-item"><a href="../appendices/helpful_tooling.html"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Helpful Tooling for Working with and Debugging Machine Learning Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Machine Learning for Mechanical Engineering</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part1/part1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundational Skills</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part1/reviewing_supervised_linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Reviewing Supervised Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/cross_validation_linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Evaluating Machine Learning Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/supervised_linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Gradient Descent</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part1/linear_decompositions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Review of Linear Unsupervised Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part1/taking_derivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Taking Derivatives</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../problems/problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problems/ps1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Problem Set 1</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../notebooks/notebooks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">In-Class Notebooks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/california_housing_visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Housing Price Data Visualization In-Class Exercise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/supervised_linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Gradient Descent</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/pytorch_autograd_verlet_integrator.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Demonstration of AD on Verlet Integration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/loss_functions_for_linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Examples of Loss Functions for Linear Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/helpful_tooling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Helpful Tooling for Working with and Debugging Machine Learning Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/course_progression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Course Lecture Progression</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#tldr-checklist" id="toc-tldr-checklist" class="nav-link active" data-scroll-target="#tldr-checklist"><span class="header-section-number">A.1</span> TL;DR Checklist</a></li>
  <li><a href="#reproducible-runs" id="toc-reproducible-runs" class="nav-link" data-scroll-target="#reproducible-runs"><span class="header-section-number">A.2</span> Reproducible Runs</a>
  <ul class="collapse">
  <li><a href="#python-project-setup" id="toc-python-project-setup" class="nav-link" data-scroll-target="#python-project-setup"><span class="header-section-number">A.2.1</span> Python Project Setup</a></li>
  <li><a href="#seeded-runs" id="toc-seeded-runs" class="nav-link" data-scroll-target="#seeded-runs"><span class="header-section-number">A.2.2</span> Seeded Runs</a></li>
  <li><a href="#hyperparameters" id="toc-hyperparameters" class="nav-link" data-scroll-target="#hyperparameters"><span class="header-section-number">A.2.3</span> Hyperparameters</a></li>
  </ul></li>
  <li><a href="#code-management" id="toc-code-management" class="nav-link" data-scroll-target="#code-management"><span class="header-section-number">A.3</span> Code Management</a>
  <ul class="collapse">
  <li><a href="#code-organization" id="toc-code-organization" class="nav-link" data-scroll-target="#code-organization"><span class="header-section-number">A.3.1</span> Code Organization</a></li>
  <li><a href="#version-control" id="toc-version-control" class="nav-link" data-scroll-target="#version-control"><span class="header-section-number">A.3.2</span> Version Control</a></li>
  <li><a href="#formatting-and-linting" id="toc-formatting-and-linting" class="nav-link" data-scroll-target="#formatting-and-linting"><span class="header-section-number">A.3.3</span> Formatting and Linting</a></li>
  <li><a href="#type-hints" id="toc-type-hints" class="nav-link" data-scroll-target="#type-hints"><span class="header-section-number">A.3.4</span> Type Hints</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing"><span class="header-section-number">A.3.5</span> Testing</a></li>
  <li><a href="#integrated-development-environments-ides" id="toc-integrated-development-environments-ides" class="nav-link" data-scroll-target="#integrated-development-environments-ides"><span class="header-section-number">A.3.6</span> Integrated Development Environments (IDEs)</a></li>
  <li><a href="#large-language-models-llms-for-coding" id="toc-large-language-models-llms-for-coding" class="nav-link" data-scroll-target="#large-language-models-llms-for-coding"><span class="header-section-number">A.3.7</span> Large Language Models (LLMs) for Coding</a></li>
  </ul></li>
  <li><a href="#debugging" id="toc-debugging" class="nav-link" data-scroll-target="#debugging"><span class="header-section-number">A.4</span> Debugging</a>
  <ul class="collapse">
  <li><a href="#visualizing" id="toc-visualizing" class="nav-link" data-scroll-target="#visualizing"><span class="header-section-number">A.4.1</span> Visualizing</a></li>
  <li><a href="#split-your-pipeline" id="toc-split-your-pipeline" class="nav-link" data-scroll-target="#split-your-pipeline"><span class="header-section-number">A.4.2</span> Split Your Pipeline</a></li>
  <li><a href="#start-small-then-scale" id="toc-start-small-then-scale" class="nav-link" data-scroll-target="#start-small-then-scale"><span class="header-section-number">A.4.3</span> Start Small, Then Scale</a></li>
  <li><a href="#performance-profiling-with-timeit" id="toc-performance-profiling-with-timeit" class="nav-link" data-scroll-target="#performance-profiling-with-timeit"><span class="header-section-number">A.4.4</span> Performance Profiling with <code>timeit</code></a></li>
  </ul></li>
  <li><a href="#a-practical-example" id="toc-a-practical-example" class="nav-link" data-scroll-target="#a-practical-example"><span class="header-section-number">A.5</span> A Practical Example</a>
  <ul class="collapse">
  <li><a href="#step-0-the-ugly-script" id="toc-step-0-the-ugly-script" class="nav-link" data-scroll-target="#step-0-the-ugly-script"><span class="header-section-number">A.5.1</span> Step 0: The Ugly Script</a></li>
  <li><a href="#step-1-from-ugly-to-bad" id="toc-step-1-from-ugly-to-bad" class="nav-link" data-scroll-target="#step-1-from-ugly-to-bad"><span class="header-section-number">A.5.2</span> Step 1: From Ugly to Bad</a></li>
  <li><a href="#step-2-debugging" id="toc-step-2-debugging" class="nav-link" data-scroll-target="#step-2-debugging"><span class="header-section-number">A.5.3</span> Step 2: Debugging</a></li>
  <li><a href="#step-3-make-your-script-as-deterministic-as-possible" id="toc-step-3-make-your-script-as-deterministic-as-possible" class="nav-link" data-scroll-target="#step-3-make-your-script-as-deterministic-as-possible"><span class="header-section-number">A.5.4</span> Step 3: Make your Script as Deterministic as possible</a></li>
  <li><a href="#step-4-visualizing" id="toc-step-4-visualizing" class="nav-link" data-scroll-target="#step-4-visualizing"><span class="header-section-number">A.5.5</span> Step 4: Visualizing</a></li>
  <li><a href="#step-5-normalizing-features" id="toc-step-5-normalizing-features" class="nav-link" data-scroll-target="#step-5-normalizing-features"><span class="header-section-number">A.5.6</span> Step 5: Normalizing Features</a></li>
  <li><a href="#step-6-visualizing-predictions" id="toc-step-6-visualizing-predictions" class="nav-link" data-scroll-target="#step-6-visualizing-predictions"><span class="header-section-number">A.5.7</span> Step 6: Visualizing Predictions</a></li>
  <li><a href="#step-7-adjusting-hyperparameters" id="toc-step-7-adjusting-hyperparameters" class="nav-link" data-scroll-target="#step-7-adjusting-hyperparameters"><span class="header-section-number">A.5.8</span> Step 7: Adjusting Hyperparameters</a></li>
  <li><a href="#final-code" id="toc-final-code" class="nav-link" data-scroll-target="#final-code"><span class="header-section-number">A.5.9</span> Final Code</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../appendices/helpful_tooling.html">Appendices</a></li><li class="breadcrumb-item"><a href="../appendices/helpful_tooling.html"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Helpful Tooling for Working with and Debugging Machine Learning Models</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-helpful-tooling" class="quarto-section-identifier">Appendix A — Helpful Tooling for Working with and Debugging Machine Learning Models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Machine learning projects are notoriously brittle: minor implementation details can cause major differences in outcomes. Good practices and tools make your implementation <strong>reproducible</strong> (and thus <strong>debuggable</strong>), and <strong>portable</strong> across different hardware environments, such as a teammate’s laptop or a high-performance computing (HPC) system.</p>
<p>Unlike traditional programming, debugging ML models by simply “running and fixing in a loop” is rarely effective. Instead, a structured set of practices and tools is needed to understand model behavior and reproduce results reliably.</p>
<section id="tldr-checklist" class="level2" data-number="A.1">
<h2 data-number="A.1" class="anchored" data-anchor-id="tldr-checklist"><span class="header-section-number">A.1</span> TL;DR Checklist</h2>
<p>Here is what we encourage doing, sorted by impact over effort.</p>
<ol type="1">
<li><a href="#integrated-development-environments-ides"><strong>Environment</strong></a> &amp; <a href="#python-project-setup"><strong>Dependencies</strong></a>: Use a proper development environment, virtual environments and pin package versions. Document GPU/CUDA.<br>
</li>
<li><a href="#formatting-and-linting"><strong>Linting</strong></a>: Use tools like <code>ruff</code> to help you write clean code from the start.</li>
<li><a href="#seeded-runs"><strong>Random Seeds</strong></a>: Seed all libraries (<code>torch</code>, <code>numpy</code>, <code>random</code>) and enable deterministic operations.<br>
</li>
<li><a href="#hyperparameters"><strong>Logging</strong></a> &amp; <a href="#split-your-pipeline"><strong>Checkpoints</strong></a>: Log hyperparameters, save models, track experiments (e.g., wandb).<br>
</li>
<li><a href="#visualizing"><strong>Visualization</strong></a>: Plot data and learning curves.</li>
<li><a href="#start-small-then-scale"><strong>Start Small Then Scale</strong></a>: Debug on small datasets first.<br>
</li>
<li><a href="#version-control"><strong>Version Control</strong></a>: Track code with Git; use branches for experiments.<br>
</li>
<li><a href="#code-organization"><strong>Modular Code</strong></a>: Split code into functions/classes and separate files.<br>
</li>
<li><a href="#testing"><strong>Testing</strong></a> &amp; <a href="type-hints"><strong>Type Hints</strong></a>: Write <code>pytest</code> tests and use <code>mypy</code> for type checking.</li>
</ol>
</section>
<section id="reproducible-runs" class="level2" data-number="A.2">
<h2 data-number="A.2" class="anchored" data-anchor-id="reproducible-runs"><span class="header-section-number">A.2</span> Reproducible Runs</h2>
<p>The first requirement for a robust ML project is to make the codebase <strong>deterministic</strong>. Because ML is inherently probabilistic, running the same code twice without precautions may yield different results. Determinism is therefore a prerequisite for debugging.</p>
<section id="python-project-setup" class="level3" data-number="A.2.1">
<h3 data-number="A.2.1" class="anchored" data-anchor-id="python-project-setup"><span class="header-section-number">A.2.1</span> Python Project Setup</h3>
<p>A good practice is to use a virtual environment (e.g., <a href="https://www.w3schools.com/python/python_virtualenv.asp"><code>venv</code></a>) to isolate dependencies. This prevents conflicts between projects (e.g., my linear regression project uses <code>sklearn</code> 1.0.2, and my generative design project uses <code>sklearn</code> 2.5.3) and avoids interfering with the base operating system.</p>
<p>Dependencies should be pinned to exact versions in a file such as <code>pyproject.toml</code> or <code>requirements.txt</code>. This enables others (including future you) to reproduce the same environment.</p>
<p>Note that not all dependencies are automatically captured in Python configuration files—for instance, the CUDA version used for GPU processing must be documented separately (typically in a <code>README.md</code>).</p>
</section>
<section id="seeded-runs" class="level3" data-number="A.2.2">
<h3 data-number="A.2.2" class="anchored" data-anchor-id="seeded-runs"><span class="header-section-number">A.2.2</span> Seeded Runs</h3>
<p>Most ML techniques involve randomness (e.g., parameter initialization, sampling, data shuffling). To ensure reproducibility, it is necessary to set a <em>random seed</em> so that random number generators produce a deterministic sequence.</p>
<p>In practice, several libraries must be seeded and it will look similar to:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch <span class="im">as</span> th</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>my_seed <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>th.manual_seed(my_seed)  <span class="co"># PyTorch</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>th.backends.cudnn.deterministic <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>torch.cuda.benchmark <span class="op">=</span> <span class="va">False</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng(my_seed)  <span class="co"># NumPy</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>random.seed(my_seed)  <span class="co"># Python's built-in random</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="hyperparameters" class="level3" data-number="A.2.3">
<h3 data-number="A.2.3" class="anchored" data-anchor-id="hyperparameters"><span class="header-section-number">A.2.3</span> Hyperparameters</h3>
<p>Hyperparameter values can influence results as strongly as changing the algorithm itself. It is essential to record which hyperparameters were used for each experiment.</p>
<p>Experiment-tracking platforms automate this process. For example, <a href="https://wandb.ai/site/">Weights and Biases</a> (wandb) can log hyperparameters, Python version, and hardware details, as well as visualize results such as learning curves. See, for example:</p>
<ul>
<li><a href="https://wandb.ai/engibench/engiopt/runs/j7wb71oh/overview">Run overview</a> with hyperparameter “Config.”</li>
<li><a href="https://wandb.ai/engibench/engiopt/runs/j7wb71oh">Learning curves and sampled designs</a></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>Once versions, seeds and hyperparameters are fixed, <strong>running the model multiple times should yield identical results across runs</strong> (look at the wandb curves). Inconsistent results usually indicate a missing seed or an unpinned dependency. Without determinism, debugging will be much more time-consuming. We strongly advise to pay attention to this.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Other Sources of Non-Determinism
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This is unlikely to happen within the course but it is still worth mentioning.</p>
<p>Even if you set seeds and pin library versions, some sources of non-determinism may persist due to the environment:</p>
<ul>
<li><strong>Multithreading or parallelism:</strong> Operations may be executed in different orders on CPU threads.<br>
</li>
<li><strong>GPU operations:</strong> Certain GPU kernels are non-deterministic by design, even with fixed seeds.<br>
</li>
<li><strong>Library versions or BLAS/CUDA backends:</strong> Different versions of underlying math libraries may produce slightly different results.</li>
</ul>
<p>To mitigate these issues:</p>
<ul>
<li>Enable deterministic operations where possible (e.g., <code>torch.backends.cudnn.deterministic = True</code> for PyTorch).<br>
</li>
<li>Be aware that some operations may never be fully deterministic on GPU—document this for reproducibility.<br>
</li>
</ul>
</div>
</div>
</div>
</section>
</section>
<section id="code-management" class="level2" data-number="A.3">
<h2 data-number="A.3" class="anchored" data-anchor-id="code-management"><span class="header-section-number">A.3</span> Code Management</h2>
<p>ML projects should be approached as software engineering projects. Code quality and management are especially critical: poorly organized or fragile code increases the likelihood of errors and makes debugging more difficult. In addition, Python’s permissiveness can hide subtle mistakes. For example, <a href="https://numpy.org/doc/stable/user/basics.broadcasting.html">automatic broadcasting of scalars to vectors</a> may not raise an exception when performing operations on vectors or matrices of mismatched sizes, yet it can still produce incorrect results. Such silent errors are often harder to detect than explicit crashes.</p>
<section id="code-organization" class="level3" data-number="A.3.1">
<h3 data-number="A.3.1" class="anchored" data-anchor-id="code-organization"><span class="header-section-number">A.3.1</span> Code Organization</h3>
<p>Notebooks are valuable for exploration and prototyping, but they are less suited for building robust and reproducible experiments. Relying on a single notebook or script often leads to unmanageable code as the project grows. By contrast, a modular codebase is easier to test, extend, and maintain. Organizing code into <strong>smaller, modular components</strong> simplifies both debugging and collaboration.</p>
<ul>
<li>Divide the project into functions, each with a single, well-defined purpose. A useful rule of thumb is: if you cannot clearly explain what a function does in one sentence, it should probably be split.<br>
</li>
<li>Use classes when it is natural to group related data and behavior together.<br>
</li>
<li>Split large projects across multiple files to make navigation easier. Avoid single files with 1000+ lines, as they are hard to read, debug, and extend.</li>
</ul>
</section>
<section id="version-control" class="level3" data-number="A.3.2">
<h3 data-number="A.3.2" class="anchored" data-anchor-id="version-control"><span class="header-section-number">A.3.2</span> Version Control</h3>
<p>Version control ensures that specific states of a project can be identified and restored. We strongly recommend using <a href="https://git-scm.com/downloads">Git</a> (with GitHub or similar platforms) for ML projects. When working in teams, branches help manage changes and prevent conflicts.</p>
</section>
<section id="formatting-and-linting" class="level3" data-number="A.3.3">
<h3 data-number="A.3.3" class="anchored" data-anchor-id="formatting-and-linting"><span class="header-section-number">A.3.3</span> Formatting and Linting</h3>
<p>Code formatting conventions (e.g., number of spaces per indentation, placement of comments, naming conventions) do not affect program behavior but improve readability. There are formatters that can automatically fix the visual style of the code—things like indentation, line breaks, spacing around operators, and alignment.</p>
<p>Linting, goes beyond formatting: linters analyze your code for potential errors or risky patterns, such as unused variables, variables that may be undefined, or suspicious comparisons.</p>
<p><a href="https://docs.astral.sh/ruff/"><code>ruff</code></a> integrates formatting, linting, and error detection in a single tool. It improves code quality, reduces stylistic disagreements, and allows developers to focus on the intent rather than the syntax.</p>
</section>
<section id="type-hints" class="level3" data-number="A.3.4">
<h3 data-number="A.3.4" class="anchored" data-anchor-id="type-hints"><span class="header-section-number">A.3.4</span> Type Hints</h3>
<p>In addition to formatting and linting, static type checking helps catch errors before running your code. Python is dynamically typed, which means you can easily pass the wrong type of object to a function without immediate errors. Tools like <a href="http://mypy-lang.org/"><code>mypy</code></a> analyze your code using type hints and report mismatches.</p>
<p>For example, in:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_numbers(a: <span class="bu">int</span>, b: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>add_numbers(<span class="dv">2</span>, <span class="st">"3"</span>) <span class="co"># note the String here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Running <code>mypy</code> will output:</p>
<pre><code>main.py:4: error: Argument 2 to "add_numbers" has incompatible type "str"; expected "int"  [arg-type]
Found 1 error in 1 file (checked 1 source file)</code></pre>
<p>Using type hints (<code>a: int</code>, <code>-&gt; int</code>) together with <code>mypy</code> lets you detect bugs early, improves code readability, and helps IDEs provide better autocompletion and refactoring support.</p>
</section>
<section id="testing" class="level3" data-number="A.3.5">
<h3 data-number="A.3.5" class="anchored" data-anchor-id="testing"><span class="header-section-number">A.3.5</span> Testing</h3>
<p>Testing individual components—functions, classes, or modules—is an important way to ensure reliability. Well-written tests allow developers to:</p>
<ul>
<li><strong>Isolate potential error sources:</strong> When a bug occurs, thoroughly tested components can be excluded from investigation, saving time.<br>
</li>
<li><strong>Detect unintended side effects:</strong> Tests help ensure that changes in one part of the codebase do not break other parts.</li>
</ul>
<p>Testing and good code organization go hand in hand: modular code is naturally easier to test, and writing tests often encourages cleaner, more maintainable designs.</p>
<p>The most common tool for this is <a href="https://docs.pytest.org/en/stable/"><code>pytest</code></a>. For example:</p>
<p>If you define a function in your project:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># my_project/utils.py</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_numbers(a, b):</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can define tests with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tests/test_math.py -- this is your test file</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> my_project.utils <span class="im">import</span> add_numbers</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_add_numbers():</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> add_numbers(<span class="dv">2</span>, <span class="dv">3</span>) <span class="op">==</span> <span class="dv">5</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> add_numbers(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="op">==</span> <span class="dv">0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Running <code>pytest</code> will automatically discover these tests and report any failures.</p>
</section>
<section id="integrated-development-environments-ides" class="level3" data-number="A.3.6">
<h3 data-number="A.3.6" class="anchored" data-anchor-id="integrated-development-environments-ides"><span class="header-section-number">A.3.6</span> Integrated Development Environments (IDEs)</h3>
<p>While you can write Python code in any text editor, using an IDE significantly improves productivity. <a href="https://code.visualstudio.com/"><strong>Visual Studio Code (VS Code)</strong></a> is the most popular choice for Python and ML development. It supports:</p>
<ul>
<li><strong>Extensions:</strong> Add functionality and friendly interface for linting <a href="#linting"><code>ruff</code></a>, type checking <a href="#type-hints"><code>mypy</code></a>, testing <a href="#testing"><code>pytest</code></a>, and <a href="#version-control"><code>git</code></a> integration.<br>
</li>
<li><strong>Handling of virtual environments:</strong> VSCode can create and handle virtual environments for you.</li>
<li><strong>Debugger:</strong> Set breakpoints and inspect the current state of variables, run instruction by instruction. This is much easier than putting prints everywhere.</li>
<li><strong>Notebooks inside VS Code:</strong> You can run Jupyter notebooks directly within your IDE.</li>
<li><strong>LLMs integration</strong>: Students have access to GitHub education (and Copilot), VSCode has a direct LLM integration for code completion and agent.</li>
</ul>
</section>
<section id="large-language-models-llms-for-coding" class="level3" data-number="A.3.7">
<h3 data-number="A.3.7" class="anchored" data-anchor-id="large-language-models-llms-for-coding"><span class="header-section-number">A.3.7</span> Large Language Models (LLMs) for Coding</h3>
<p>Tools like ChatGPT or GitHub Copilot can generate code quickly. While this can accelerate boilerplate writing, <strong>it does not replace understanding</strong>.</p>
<p>Machine learning code is particularly sensitive to details: a small mistake in data preprocessing, tensor dimensions, or random seeding can completely change results. Using LLMs without knowing what the code does may:</p>
<ul>
<li>Hide important assumptions.<br>
</li>
<li>Lead to silent bugs that are hard to detect.<br>
</li>
<li>Prevent you from learning how ML algorithms really work.</li>
</ul>
<p>Guideline: LLMs are great for generating snippets (e.g., “write a function to convert my CSV data to JSON”), but always <strong>read, run, and understand the code</strong> before using it in experiments. For ML, correctness and reproducibility are more important than speed.</p>
</section>
</section>
<section id="debugging" class="level2" data-number="A.4">
<h2 data-number="A.4" class="anchored" data-anchor-id="debugging"><span class="header-section-number">A.4</span> Debugging</h2>
<p>If the codebase is well-structured and reproducible but issues persist, the problem is likely related to the maths, hyperparameters, or data.</p>
<section id="visualizing" class="level3" data-number="A.4.1">
<h3 data-number="A.4.1" class="anchored" data-anchor-id="visualizing"><span class="header-section-number">A.4.1</span> Visualizing</h3>
<p>Visualization is one of the most effective debugging tools in ML, particularly in engineering contexts where results can often be represented graphically.</p>
<section id="algorithm-level-visualizations" class="level4" data-number="A.4.1.1">
<h4 data-number="A.4.1.1" class="anchored" data-anchor-id="algorithm-level-visualizations"><span class="header-section-number">A.4.1.1</span> Algorithm-level Visualizations</h4>
<ul>
<li><strong>Loss curves:</strong> Simple plots can reveal overfitting, underfitting, or learning failures.</li>
<li><strong>Predictions:</strong> Comparing model outputs with reference data at various training stages provides direct insight into progress.</li>
</ul>
<p>For these, we often report metrics and outputs in wandb, see for instance <a href="https://github.com/IDEALLab/EngiOpt/blob/main/engiopt/cgan_cnn_2d/cgan_cnn_2d.py#L354-L361">these lines</a>.</p>
</section>
<section id="data-level-visualizations" class="level4" data-number="A.4.1.2">
<h4 data-number="A.4.1.2" class="anchored" data-anchor-id="data-level-visualizations"><span class="header-section-number">A.4.1.2</span> Data-level Visualizations</h4>
<ul>
<li><strong>Inspect dataset distributions:</strong> Check whether features are on compatible scales, whether rescaling or normalization is needed, and whether outliers are present. Tools like <code>matplotlib</code> or <code>seaborn</code> can help.<br>
</li>
<li><strong>Assess assumptions:</strong> Determine whether the data distribution aligns with the model’s underlying assumptions, e.g., can the data distribution be captured by a Gaussian distribution.</li>
</ul>
</section>
</section>
<section id="split-your-pipeline" class="level3" data-number="A.4.2">
<h3 data-number="A.4.2" class="anchored" data-anchor-id="split-your-pipeline"><span class="header-section-number">A.4.2</span> Split Your Pipeline</h3>
<p>It is good practice to split your training pipeline into distinct stages:</p>
<ul>
<li><strong>Data analysis:</strong> <a href="#visualizing">Visualize</a> your data. Look at the distributions, detect outliers, and gain insights into what preprocessing might be needed and which models may perform well.</li>
<li><strong>Data pre-processing:</strong> Massage your data before feeding it to the model. <a href="#visualizing">Visualize</a> to ensure transformations are correct and consistent.</li>
<li><strong>Training:</strong> Train your model on the preprocessed data. Save trained models to disk after each run (<code>torch.save</code>, <code>pickle</code>, or similar). This allows you to avoid retraining from scratch every time you tweak evaluation code.<br>
</li>
<li><strong>Evaluation:</strong> Load the saved model and run your evaluation routines on validation or test datasets.</li>
</ul>
<p>By separating these stages, you can debug each part independently, and validate progress.</p>
</section>
<section id="start-small-then-scale" class="level3" data-number="A.4.3">
<h3 data-number="A.4.3" class="anchored" data-anchor-id="start-small-then-scale"><span class="header-section-number">A.4.3</span> Start Small, Then Scale</h3>
<p>When debugging, it is inefficient to run large-scale experiments immediately. Instead:</p>
<ul>
<li>Begin with small, fast experiments (e.g., a reduced dataset or a lightweight simulator).<br>
</li>
<li>Validate that the model can learn on trivial cases.<br>
</li>
<li>Attempt to reproduce established results or baseline performance.</li>
</ul>
<p>Scaling to larger, more complex runs should only occur once smaller experiments confirm that the model behaves as expected.</p>
</section>
<section id="performance-profiling-with-timeit" class="level3" data-number="A.4.4">
<h3 data-number="A.4.4" class="anchored" data-anchor-id="performance-profiling-with-timeit"><span class="header-section-number">A.4.4</span> Performance Profiling with <code>timeit</code></h3>
<p>Sometimes the bug is actually that the code is too slow. When this happens, the first step is often to measure <em>where</em> the time goes. You can do that with Python’s built-in <a href="https://docs.python.org/3/library/timeit.html"><code>timeit</code></a>.</p>
<p><code>timeit</code> runs a snippet of code multiple times and reports the average execution time, helping you compare different implementations or detect bottlenecks.</p>
<p>Here is an example for normalizing data:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> timeit</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>setup <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">import numpy as np</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">data = np.random.rand(10000, 100)  # 10k samples, 100 features</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: Pure Python loops</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>stmt1 <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="st">normalized = []</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="st">for row in data:</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="st">    mean = np.mean(row)</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="st">    std = np.std(row)</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="st">    normalized.append((row - mean) / std)</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="st">normalized = np.array(normalized)</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: NumPy vectorization</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>stmt2 <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="st">means = np.mean(data, axis=1, keepdims=True)</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="st">stds = np.std(data, axis=1, keepdims=True)</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="st">normalized = (data - means) / stds</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Python loops:"</span>, timeit.timeit(stmt1, setup<span class="op">=</span>setup, number<span class="op">=</span><span class="dv">10</span>))</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"NumPy vectorization:"</span>, timeit.timeit(stmt2, setup<span class="op">=</span>setup, number<span class="op">=</span><span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Results:</p>
<pre><code>Python loops: 0.8857301659882069
NumPy vectorization: 0.04489224997814745</code></pre>
<p>Using NumPy vectorization is ~20x faster than Python loops.</p>
<p>In notebooks, you don’t even need imports:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="bu">sum</span>(<span class="bu">range</span>(<span class="dv">1000</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="a-practical-example" class="level2" data-number="A.5">
<h2 data-number="A.5" class="anchored" data-anchor-id="a-practical-example"><span class="header-section-number">A.5</span> A Practical Example</h2>
<p>This section shows a practical example using the techniques explained above on an actual code.</p>
<section id="step-0-the-ugly-script" class="level3" data-number="A.5.1">
<h3 data-number="A.5.1" class="anchored" data-anchor-id="step-0-the-ugly-script"><span class="header-section-number">A.5.1</span> Step 0: The Ugly Script</h3>
<p>We start with some messy code that Ruff would flag:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># train.py</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np, torch, torch.nn <span class="im">as</span> nn, torch.optim <span class="im">as</span> optim, matplotlib.pyplot <span class="im">as</span> plt, random</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>np.linspace(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">100</span>).reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span><span class="dv">5</span><span class="op">*</span>np.sin(<span class="fl">0.1</span><span class="op">*</span>X)<span class="op">+</span>np.random.randn(<span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> nn.Linear(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.SGD(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>loss_fn <span class="op">=</span> nn.MSELoss()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">500</span>):</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> model(torch.tensor(X))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> loss_fn(pred, torch.tensor(y))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Epoch </span><span class="sc">{</span>epoch<span class="sc">}</span><span class="ss"> - Loss: </span><span class="sc">{</span>loss<span class="sc">.</span>item()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>At first glance, it looks okay but it won’t run. Try executing <code>python train.py</code> to see the errors.</p>
</section>
<section id="step-1-from-ugly-to-bad" class="level3" data-number="A.5.2">
<h3 data-number="A.5.2" class="anchored" data-anchor-id="step-1-from-ugly-to-bad"><span class="header-section-number">A.5.2</span> Step 1: From Ugly to Bad</h3>
<p>Run <a href="#formatting-and-linting">ruff</a> to format and check. Fix the errors (or call <code>ruff check --fix train.py</code>).</p>
<p>Now the code is already cleaner and easier to debug. Still, running the file throws errors.</p>
</section>
<section id="step-2-debugging" class="level3" data-number="A.5.3">
<h3 data-number="A.5.3" class="anchored" data-anchor-id="step-2-debugging"><span class="header-section-number">A.5.3</span> Step 2: Debugging</h3>
<p>Running python train.py gives a cryptic type error at the loss computation: <code>RuntimeError: mat1 and mat2 must have the same dtype, but got Double and Float</code>.</p>
<p>The problem is that the model outputs <code>float32</code> predictions while y is <code>float64</code>. This causes a mismatch in the loss computation. The fix is to change the lines to:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode diff code-with-copy"><code class="sourceCode diff"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="st">- pred = model(torch.tensor(X))</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="st">- loss = loss_fn(pred, torch.tensor(y))</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="va">+ pred = model(torch.tensor(X, dtype=torch.float32))</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="va">+ loss = loss_fn(pred, torch.tensor(y, dtype=torch.float32))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-3-make-your-script-as-deterministic-as-possible" class="level3" data-number="A.5.4">
<h3 data-number="A.5.4" class="anchored" data-anchor-id="step-3-make-your-script-as-deterministic-as-possible"><span class="header-section-number">A.5.4</span> Step 3: Make your Script as Deterministic as possible</h3>
<p>It is important to remove sources of non determinism when debugging ML models, see <a href="#seeded-runs">seeding</a>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># right after the imports</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng(<span class="dv">42</span>)  <span class="co"># seed NumPy random</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">42</span>)  <span class="co"># seed PyTorch</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>torch.cuda.manual_seed(<span class="dv">42</span>)  <span class="co"># see PyTorch CUDA (for NVIDIA GPUs)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>torch.backends.cudnn.deterministic <span class="op">=</span> <span class="va">True</span>  <span class="co"># tell PyTorch to use deterministic kernels</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>torch.backends.cudnn.benchmark <span class="op">=</span> <span class="va">False</span> <span class="co"># removes internal optimizations that can cause non-determinism </span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>And when defining your outputs:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode diff code-with-copy"><code class="sourceCode diff"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a># replace np.random by the seeded RNG</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="st">- y = 5 * np.sin(0.1 * X) + np.random.randn(100, 1)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="va">+ y = 5 * np.sin(0.1 * X) + rng.standard_normal(size=(100, 1))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="step-4-visualizing" class="level3" data-number="A.5.5">
<h3 data-number="A.5.5" class="anchored" data-anchor-id="step-4-visualizing"><span class="header-section-number">A.5.5</span> Step 4: Visualizing</h3>
<p>It is extremely important to <a href="#visualizing">visualize</a> your data. For this, we can add this to the script:</p>
<section id="visualizing-data" class="level4" data-number="A.5.5.1">
<h4 data-number="A.5.5.1" class="anchored" data-anchor-id="visualizing-data"><span class="header-section-number">A.5.5.1</span> Visualizing data</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>and before the training loop:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(X, y)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"X"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"y"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Raw sinusoidal data"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="visualizing-loss" class="level4" data-number="A.5.5.2">
<h4 data-number="A.5.5.2" class="anchored" data-anchor-id="visualizing-loss"><span class="header-section-number">A.5.5.2</span> Visualizing loss</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># before training loop</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>losses <span class="op">=</span> []</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># in your training loop</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>losses.append(loss.item())</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># after training loop</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>plt.plot(losses)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Epoch"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Loss"</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Loss over time"</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Observations</strong>:</p>
<ul>
<li>The target is sinusoidal, a simple linear model cannot capture this (we’ve made bad assumptions for the model).</li>
<li>The loss is producing <code>nan</code>s and going to <code>inf</code>.</li>
<li>The features are not normalized, making learning difficult.</li>
</ul>
</section>
</section>
<section id="step-5-normalizing-features" class="level3" data-number="A.5.6">
<h3 data-number="A.5.6" class="anchored" data-anchor-id="step-5-normalizing-features"><span class="header-section-number">A.5.6</span> Step 5: Normalizing Features</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>X_mean <span class="op">=</span> X.mean(axis<span class="op">=</span><span class="dv">0</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>X_std <span class="op">=</span> X.std(axis<span class="op">=</span><span class="dv">0</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>X_norm <span class="op">=</span> (X <span class="op">-</span> X_mean) <span class="op">/</span> X_std</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>X_tensor <span class="op">=</span> torch.tensor(X_norm, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>y_tensor <span class="op">=</span> torch.tensor(y, dtype<span class="op">=</span>torch.float32)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Use these normalized tensors in the training loop instead of the raw values.</p>
</section>
<section id="step-6-visualizing-predictions" class="level3" data-number="A.5.7">
<h3 data-number="A.5.7" class="anchored" data-anchor-id="step-6-visualizing-predictions"><span class="header-section-number">A.5.7</span> Step 6: Visualizing Predictions</h3>
<p>Now the loss seems to go down, the code runs. Let’s look at the predictions. This code will help you visualize the predictions vs.&nbsp;the true values:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># after the training loop</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    predictions <span class="op">=</span> model(X_tensor)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.scatter(X_tensor.numpy(), y_tensor.numpy(), label<span class="op">=</span><span class="st">"True data"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    X_tensor.numpy(), predictions.numpy(), label<span class="op">=</span><span class="st">"Predictions"</span>, color<span class="op">=</span><span class="st">"red"</span>, alpha<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"X"</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"y"</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"True vs Predicted"</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Observation:</strong> It is pretty obvious that our model has not enough capacity to capture the data.</p>
</section>
<section id="step-7-adjusting-hyperparameters" class="level3" data-number="A.5.8">
<h3 data-number="A.5.8" class="anchored" data-anchor-id="step-7-adjusting-hyperparameters"><span class="header-section-number">A.5.8</span> Step 7: Adjusting Hyperparameters</h3>
<p>Let’s try to increase the model size.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> nn.Sequential(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    nn.Linear(<span class="dv">1</span>, <span class="dv">16</span>), nn.ReLU(), nn.Linear(<span class="dv">16</span>, <span class="dv">16</span>), nn.ReLU(), nn.Linear(<span class="dv">16</span>, <span class="dv">1</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>And re-run. Now we see the loss is not optimal.</p>
<ul>
<li>Can you adjust the learning rate and model size?</li>
<li>And how are you going to keep track of what combination of hyperparameter values you have tried?</li>
<li>Also, you have several plots (prediction, loss) for each run which are helpful.</li>
</ul>
<p>For this, we recommend using experiment trackers, such as <a href="#hyperparameters">weights and biases</a>.</p>
<p>First, you start by defining your hyperparameters on top the file:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="op">=</span> {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"learning_rate"</span>: <span class="fl">0.01</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"model_layers"</span>: [<span class="dv">16</span>, <span class="dv">16</span>],</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"activation"</span>: <span class="st">"ReLU"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>and use them in your training script. For instance, your model definition becomes</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>model_layers: <span class="bu">list</span>[<span class="bu">int</span>] <span class="op">=</span> hyperparameters[<span class="st">"model_layers"</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>layers <span class="op">=</span> []</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Build all layers including input and hidden layers -- this allows to just change the model_layers in your hyperparameters dictionary.</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>current_size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> layer_size <span class="kw">in</span> model_layers:</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    layers.append(nn.Linear(current_size, layer_size))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> hyperparameters[<span class="st">"activation"</span>] <span class="op">==</span> <span class="st">"ReLU"</span>:</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        layers.append(nn.ReLU())</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> hyperparameters[<span class="st">"activation"</span>] <span class="op">==</span> <span class="st">"Sigmoid"</span>:</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        layers.append(nn.Sigmoid())</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    current_size <span class="op">=</span> layer_size</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add output layer</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>layers.append(nn.Linear(current_size, <span class="dv">1</span>))</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> nn.Sequential(<span class="op">*</span>layers)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.SGD(model.parameters(), lr<span class="op">=</span>hyperparameters[<span class="st">"learning_rate"</span>]) <span class="co"># see hyperparameter here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Then, you log these hyperparameters for each experiment:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a> wandb.init(project<span class="op">=</span><span class="st">"example"</span>, config<span class="op">=</span>hyperparameters)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>In your training loop:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>wandb.log({<span class="st">"loss"</span>: loss.item()})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can even log an image of prediction vs.&nbsp;true data at each training step. See below.</p>
</section>
<section id="final-code" class="level3" data-number="A.5.9">
<h3 data-number="A.5.9" class="anchored" data-anchor-id="final-code"><span class="header-section-number">A.5.9</span> Final Code</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wandb</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng(<span class="dv">42</span>)  <span class="co"># seed NumPy random</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">42</span>)  <span class="co"># seed PyTorch</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>torch.cuda.manual_seed(<span class="dv">42</span>)  <span class="co"># see PyTorch CUDA (for NVIDIA GPUs)</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>torch.backends.cudnn.deterministic <span class="op">=</span> <span class="va">True</span>  <span class="co"># tell PyTorch to use deterministic kernels</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>torch.backends.cudnn.benchmark <span class="op">=</span> (</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">False</span>  <span class="co"># removes internal optimizations that can cause non-determinism</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="op">=</span> {</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"learning_rate"</span>: <span class="fl">0.01</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"model_layers"</span>: [<span class="dv">16</span>, <span class="dv">16</span>],</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"activation"</span>: <span class="st">"ReLU"</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predictions_plot(visualize: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, log: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Plot the predictions vs. the true values.</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co">        visualize: Whether to show the plot.</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co">        log: Whether to log the plot to wandb.</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        predictions <span class="op">=</span> model(X_tensor)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    plt.scatter(X_tensor.numpy(), y_tensor.numpy(), label<span class="op">=</span><span class="st">"True data"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    plt.scatter(</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>        X_tensor.numpy(),</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>        predictions.numpy(),</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">"Predictions"</span>,</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"red"</span>,</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"X"</span>)</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"y"</span>)</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"True vs Predicted"</span>)</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> visualize:</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>        plt.savefig(<span class="st">"predictions.png"</span>)</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> log:</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>            wandb.log({<span class="st">"predictions"</span>: wandb.Image(<span class="st">"predictions.png"</span>)})</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>        plt.close()  <span class="co"># Close the figure to free memory</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>    wandb.init(project<span class="op">=</span><span class="st">"example"</span>, config<span class="op">=</span>hyperparameters)</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">100</span>).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> np.sin(<span class="fl">0.1</span> <span class="op">*</span> X) <span class="op">+</span> rng.standard_normal(size<span class="op">=</span>(<span class="dv">100</span>, <span class="dv">1</span>))</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>    X_mean <span class="op">=</span> X.mean(axis<span class="op">=</span><span class="dv">0</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>    X_std <span class="op">=</span> X.std(axis<span class="op">=</span><span class="dv">0</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>    X_norm <span class="op">=</span> (X <span class="op">-</span> X_mean) <span class="op">/</span> X_std</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>    X_tensor <span class="op">=</span> torch.tensor(X_norm, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>    y_tensor <span class="op">=</span> torch.tensor(y, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>    model_layers: <span class="bu">list</span>[<span class="bu">int</span>] <span class="op">=</span> hyperparameters[<span class="st">"model_layers"</span>]</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>    layers <span class="op">=</span> []</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build all layers including input and hidden layers</span></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>    current_size <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer_size <span class="kw">in</span> model_layers:</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>        layers.append(nn.Linear(current_size, layer_size))</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> hyperparameters[<span class="st">"activation"</span>] <span class="op">==</span> <span class="st">"ReLU"</span>:</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>            layers.append(nn.ReLU())</span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> hyperparameters[<span class="st">"activation"</span>] <span class="op">==</span> <span class="st">"Sigmoid"</span>:</span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>            layers.append(nn.Sigmoid())</span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>        current_size <span class="op">=</span> layer_size</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add output layer</span></span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a>    layers.append(nn.Linear(current_size, <span class="dv">1</span>))</span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> nn.Sequential(<span class="op">*</span>layers)</span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.SGD(model.parameters(), lr<span class="op">=</span>hyperparameters[<span class="st">"learning_rate"</span>])</span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a>    loss_fn <span class="op">=</span> nn.MSELoss()</span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>    losses <span class="op">=</span> []</span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">500</span>):</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a>        pred <span class="op">=</span> model(X_tensor)</span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> loss_fn(pred, y_tensor)</span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Epoch </span><span class="sc">{</span>epoch<span class="sc">}</span><span class="ss"> - Loss: </span><span class="sc">{</span>loss<span class="sc">.</span>item()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a>        wandb.log({<span class="st">"loss"</span>: loss.item()})</span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Log predictions image to wandb during training (but don't show plot)</span></span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a>        predictions_plot(visualize<span class="op">=</span><span class="va">False</span>, log<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a>        losses.append(loss.item())</span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>    plt.plot(losses)</span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Epoch"</span>)</span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Loss"</span>)</span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Loss over time"</span>)</span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show predictions plot at the end of training</span></span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a>    predictions_plot(visualize<span class="op">=</span><span class="va">True</span>, log<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a>    wandb.finish()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notebooks/loss_functions_for_linear_models.html" class="pagination-link" aria-label="Examples of Loss Functions for Linear Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Examples of Loss Functions for Linear Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../appendices/course_progression.html" class="pagination-link" aria-label="Course Lecture Progression">
        <span class="nav-page-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Course Lecture Progression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Machine Learning for Mechanical Engineers © 2025 by <a href="./index.qmd#sec-contributors">Mark Fuge and IDEAL Lab Contributors</a> is licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>